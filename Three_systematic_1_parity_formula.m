clc
clear
%% Constructing the matrix for 3 systematic erasures (nodes 1,2,3) and 1 parity failure (node 1)
% underscore denotes the prime notation Pij_ = (P^(-1)^t)ij= P^(-1)ij
syms P11 P11_  P21 P21_  P31 P31_   k
e=4;N=e*(e-1);
% s=[r12  r13 s11   r21   r23  s21 r31   r32    s31   s11_  s12_  s13_ ]
%     1    2    3    4    5     6    7     8     9    10     11    12     
%% First systematic node
%%%%%%%%%%%%%%%%%%%%%%%%%%%%% r12 r21 s11_
A(1,4)=-k;
A(1,10)=k* P21_;
A(1,1)=-1;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%% r13 r31 s11_ 
A(2,2)=-1;
A(2,7)= -k;
A(2,10)=k* P31_;
%%%%%%%%%%%%%%%%%%%%%%%%%%%% s11 r21 r31 s11_
A(3,3)=-1;
A(3,4)= -P21;
A(3,7)= -P31;
A(3,10)=  1-(k*P11*P11_)/(1+k) ;
%% Second systematic node
%%%%%%%%%%%%%%%%%%%%% r21 r12 s12_ 
A(4,4)= -1;
A(4,1)= -k;
A(4,11)=  k*P11_ ;
%%%%%%%%%%%%%%%%%%%%% r23 r32 s12_ 
A(5,5)= -1;
A(5,8)= -k;
A(5,11)=  k*P31_ ;
%%%%%%%%%%%%%%%%%%%%% s21 r12 r32 s12_ 
A(6,6)= -1;
A(6,1)= -P11;
A(6,8)= -P31;
A(6,11)=  1-(k*P21*P21_)/(1+k);
%% third systematic node
%%%%%%%%%%%%%%%%%%%%% r31 r13 s13_ 
A(7,7)= -1;
A(7,2)=-k;
A(7,12)=k*P11_;
%%%%%%%%%%%%%%%%%   r32 r23 s13_
A(8,8)=-1;
A(8,5)=-k;
A(8,12)=k*P21_;
%%%%%%%%%%%%%%%  s31 r13 r23 s13_ 
A(9,9)=-1;
A(9,2)= -P11 ;
A(9,5)= -P21 ;
A(9,12)=   1-(k*P31*P31_)/(1+k) ;
%% First parity node  
%%%%%%%%%%%%%%%%%%%%% s11_ s11 s21 s31 
A(10,10)=-1;
A(10,3)=  1-k^2+ k*(1+k)*P11*P11_;
A(10,6)=  k*(k+1)*P11_*P21;
A(10,9)=  k*(k+1)*P11_*P31  ; 
%%%%%%%%%%%%%%%%%%%%% s12_  s11 s21 s31 
A(11,11)=-1;
A(11,3)=  k*(k+1)*P21_*P11  ;
A(11,6)= 1-k^2+ k*(1+k)*P21*P21_ ;
A(11,9)= k*(k+1)*P21_*P31 ;
%%%%%%%%%%%%%%%%%%%%% s13_ s11 s21 s31 
A(12,12)=-1;
A(12,3)=  k*(k+1)*P31_*P11 ;
A(12,6)= k*(k+1)*P31_*P21 ;
A(12,9)= 1-k^2+ k*(1+k)*P31*P31_ ;
A
%% Compute determinant
y=det(A)
y=factor( y )
y(14)
